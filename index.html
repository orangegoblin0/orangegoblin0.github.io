
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SIH 2025 Problem Statements</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body {
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }
    .star { cursor: pointer; color: #ffffff; transition: color 0.2s; }
    .star.filled { color: rgb(255, 255, 0); }
    .ps-card:hover { transform: translateY(-5px); box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
  </style>
</head>
<body id="main-body" class="min-h-screen">

  <!-- Top Bar -->
  <div class="w-full flex flex-wrap items-center justify-between p-4 bg-black/40 backdrop-blur-xl text-white sticky top-0 z-50">
    <div class="flex items-center gap-3">
      <label class="text-sm">Reviewer:</label>
      <select id="nameDropdown" class="p-2 rounded-xl bg-black text-white">
        <option>Abhiroop</option>
        <option>Aditi</option>
        <option>Anushka</option>
        <option>Arnav</option>
        <option>Avishka</option>
        <option>Siddharth</option>
      </select>
    </div>
    <div class="flex-1 flex gap-3 justify-center flex-wrap">
      <input type="text" id="search" placeholder="🔍 Search..." class="p-2 rounded-xl bg-black text-white placeholder-white/60 w-64">
      <select id="theme-filter" class="p-2 rounded-xl bg-black text-white">
        <option value="">All Themes</option>
      </select>
      <select id="org-filter" class="p-2 rounded-xl bg-black text-white">
        <option value="">All Orgs</option>
      </select>
      <select id="type-filter" class="p-2 rounded-xl bg-black text-white">
        <option value="">All</option>
        <option value="new">New SIH PS Post-Hackathon</option>
        <option value="kj">Remove KJ Selections</option>
        <option value="sih">Remove SIH Submissions</option>
      </select>
    </div>
    <button id="downloadBtn" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-xl">⬇ Download Results</button>
  </div>

  <!-- Stats -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 p-6" id="stats">
    <div class="bg-white/20 backdrop-blur-xl p-6 rounded-xl text-center">
      <div class="text-2xl font-bold text-white" id="total-ps">0</div>
      <div class="text-white/70">Total PS</div>
    </div>
    <div class="bg-white/20 backdrop-blur-xl p-6 rounded-xl text-center">
      <div class="text-2xl font-bold text-white" id="software-ps">0</div>
      <div class="text-white/70">Software</div>
    </div>
    <div class="bg-white/20 backdrop-blur-xl p-6 rounded-xl text-center">
      <div class="text-2xl font-bold text-white" id="organizations">0</div>
      <div class="text-white/70">Organizations</div>
    </div>
    <div class="bg-white/20 backdrop-blur-xl p-6 rounded-xl text-center">
      <div class="text-2xl font-bold text-white" id="themes">0</div>
      <div class="text-white/70">Themes</div>
    </div>
  </div>

  <!-- Problem Statements -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-6" id="ps-container"></div>
  <div class="hidden text-center text-white/80 mt-10" id="no-results">No problem statements found.</div>

  <!-- Expanded Card -->
  <div id="expandedCard" class="hidden fixed inset-0 bg-black/70 backdrop-blur flex items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 max-w-3xl w-full relative overflow-y-auto max-h-[90vh]">
      <button id="closeCard" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800">✖</button>
      <div id="expandedContent"></div>
    </div>
  </div>

  <script>
    const backgroundUrl = "https://images.unsplash.com/photo-1509773896068-7fd415d91e2e?q=80&w=3269&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D";
    document.body.style.backgroundImage = `url('${backgroundUrl}')`;

    const psContainer = document.getElementById("ps-container");
    const noResults = document.getElementById("no-results");
    const expandedCard = document.getElementById("expandedCard");
    const expandedContent = document.getElementById("expandedContent");
    const closeCard = document.getElementById("closeCard");
    const nameDropdown = document.getElementById("nameDropdown");

    let allProblemStatements = [];
    let filteredStatements = [];
    let ratings = {}; 
    let oldProblemStatements = [];

    const kjTaken = [
      "SIH25002","SIH25070","SIH25048","SIH25032","SIH25047","SIH25026","SIH25081",
      "SIH25071","SIH25061","SIH25024","SIH25010","SIH25050","SIH25018","SIH25092",
      "SIH25051","SIH25033","SIH25011","SIH25073","SIH25083","SIH25038","SIH25031",
      "SIH25044","SIH25043","SIH25040","SIH25060","SIH25025","SIH25064","SIH25020",
      "SIH25042","SIH25046","SIH25066","SIH25074","SIH25009","SIH25076","SIH25015",
      "SIH25022","SIH25137","SIH25199","SIH25028","SIH25106","SIH25205"
    ];

    async function loadProblemStatements() {
      const res = await fetch("all_sih_ps_final.json");
      allProblemStatements = await res.json();
      try {
        const oldRes = await fetch("old.json");
        oldProblemStatements = await oldRes.json();
      } catch(e) {
        console.warn("old.json not found, skipping...");
      }
      filteredStatements = [...allProblemStatements];
      initFilters();
      displayProblemStatements(filteredStatements);
      updateStats();
    }

    function initFilters() {
      const themes = [...new Set(allProblemStatements.map(ps => ps["Theme"]))].sort();
      const orgs = [...new Set(allProblemStatements.map(ps => ps["Organization"]))].sort();
      const themeSel = document.getElementById("theme-filter");
      const orgSel = document.getElementById("org-filter");
      themes.forEach(t => { const o=document.createElement("option"); o.value=t; o.textContent=t; themeSel.appendChild(o); });
      orgs.forEach(o_ => { const o=document.createElement("option"); o.value=o_; o.textContent=o_; orgSel.appendChild(o); });
    }

    function createStars(psId, container, inExpanded=false) {
      container.innerHTML="";
      const user=nameDropdown.value;
      const currentRating=(ratings[psId]&&ratings[psId][user])||0;
      for (let i=1;i<=5;i++){
        const s=document.createElement("span");
        s.innerHTML = "<span style='font-size: 24px;'>★</span>";
        s.className="star"+(i<=currentRating?" filled":"");
        s.onclick=(e)=>{
          e.stopPropagation();
          if(!ratings[psId]) ratings[psId]={};
          ratings[psId][user]=i;
          displayProblemStatements(filteredStatements);
          if(inExpanded) showExpanded(psId);
        };
        container.appendChild(s);
      }
    }

    function createCard(ps) {
      const card=document.createElement("div");
      card.className="ps-card bg-white/20 backdrop-blur-xl rounded-2xl shadow-xl cursor-pointer transition transform";
      card.innerHTML=`
        <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-t-2xl">
          <div class="font-bold">SIH${ps["Problem Statement ID"]}</div>
          <div class="text-sm">${ps["Problem Statement Title"]}</div>
        </div>
        <div class="p-4">
          <div class="flex flex-wrap gap-2 mb-3">
            <span class="bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded-full">${ps["Organization"]}</span>
            <span class="bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full">${ps["Theme"]}</span>
            <span class="bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full">${ps["Category"]}</span>
          </div>
          <div class="text-white/80 text-sm mb-2">${ps["Description"].slice(0,120)}...</div>
          <div class="stars flex gap-1"></div>
        </div>`;
      card.onclick=()=>showExpanded(ps["Problem Statement ID"]);
      createStars(ps["Problem Statement ID"], card.querySelector(".stars"));
      return card;
    }

    function showExpanded(psId){
      const ps=allProblemStatements.find(p=>p["Problem Statement ID"]===psId);
      expandedContent.innerHTML=`
        <h2 class="text-2xl font-bold mb-4">${ps["Problem Statement Title"]}</h2>
        <p><strong>ID:</strong> SIH${ps["Problem Statement ID"]}</p>
        <p><strong>Organization:</strong> ${ps["Organization"]}</p>
        <p><strong>Department:</strong> ${ps["Department"]||"N/A"}</p>
        <p><strong>Theme:</strong> ${ps["Theme"]}</p>
        <div class="mt-4">${ps["Description"]}</div>
        <div class="mt-4"><strong>Rating:</strong> <div id="expanded-stars" class="flex gap-1 inline-block"></div></div>
      `;
      createStars(ps["Problem Statement ID"], document.getElementById("expanded-stars"), true);
      expandedCard.classList.remove("hidden");
    }

    function displayProblemStatements(sts) {
      psContainer.innerHTML="";
      if (!sts.length) { noResults.classList.remove("hidden"); return; }
      noResults.classList.add("hidden");
      sts.forEach(ps=>psContainer.appendChild(createCard(ps)));
    }

    function updateStats() {
      document.getElementById("total-ps").textContent=allProblemStatements.length;
      document.getElementById("software-ps").textContent=allProblemStatements.length;
      document.getElementById("organizations").textContent=new Set(allProblemStatements.map(ps=>ps["Organization"])).size;
      document.getElementById("themes").textContent=new Set(allProblemStatements.map(ps=>ps["Theme"])).size;
    }

    function filterProblemStatements() {
      const search = document.getElementById("search").value.toLowerCase();
      const theme = document.getElementById("theme-filter").value;
      const org = document.getElementById("org-filter").value;
      const type = document.getElementById("type-filter").value;

      filteredStatements = allProblemStatements.filter(ps => {
        const psNo = "sih" + ps["Problem Statement ID"].toLowerCase();
        const matchesSearch = !search ||
          ps["Problem Statement Title"].toLowerCase().includes(search) ||
          ps["Organization"].toLowerCase().includes(search) ||
          ps["Theme"].toLowerCase().includes(search) ||
          ps["Description"].toLowerCase().includes(search) ||
          psNo.includes(search);

        const matchesTheme = !theme || ps["Theme"] === theme;
        const matchesOrg = !org || ps["Organization"] === org;

        let matchesType = true;
        if (type === "new") {
          const oldIds = new Set(oldProblemStatements.map(o => o.ps_number));
          matchesType = !oldIds.has("SIH"+ps["Problem Statement ID"]);
        } else if (type === "kj") {
          matchesType = !kjTaken.includes("SIH"+ps["Problem Statement ID"]);
        } else if (type === "sih") {
          matchesType = ps["Submitted Idea(s) Count"]==="0" || ps["submitted_ideas"]==="0";
        }

        return matchesSearch && matchesTheme && matchesOrg && matchesType;
      });

      displayProblemStatements(filteredStatements);
    }

    document.getElementById("search").addEventListener("input",filterProblemStatements);
    document.getElementById("theme-filter").addEventListener("change",filterProblemStatements);
    document.getElementById("org-filter").addEventListener("change",filterProblemStatements);
    document.getElementById("type-filter").addEventListener("change",filterProblemStatements);
    closeCard.onclick=()=>expandedCard.classList.add("hidden");

    document.getElementById("downloadBtn").onclick=()=>{
      const user=nameDropdown.value;
      const data=allProblemStatements.map(ps=>({
        ps_no:"SIH"+ps["Problem Statement ID"],
        rating:(ratings[ps["Problem Statement ID"]]&&ratings[ps["Problem Statement ID"]][user])||0,
        name:user
      }));
      const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
      const a=document.createElement("a");
      a.href=URL.createObjectURL(blob);
      a.download="ratings_"+user+".json";
      a.click();
    };

    loadProblemStatements();
  </script>
</body>
</html>
